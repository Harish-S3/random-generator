{% extends 'base.html' %}

{% block title %}Fun Fact Generator{% endblock %}

{% block content %}
    <h2>Fun Fact Generator</h2>
    <div class="fun-fact-container">
        <h2 id="fun-fact-title">Did You Know?</h2>
        <p id="fun-fact-text">{{ fun_fact }}</p>
        
        <button id="get-fun-fact-btn">Get Fun Fact</button>
    </div>
    
    <a href="{{ url_for('home') }}" class="home-btn">Home</a>
    
    <script>
        document.addEventListener('DOMContentLoaded', function () {
            const getFunFactButton = document.getElementById('get-fun-fact-btn');
            const funFactTitle = document.getElementById('fun-fact-title');
            const funFactText = document.getElementById('fun-fact-text');

            const getFunFact = async () => {
                try {
                    const response = await fetch('/api/fun-facts');
                    const data = await response.json();

                    if (data && data.fun_fact) {
                        // Animate the text
                        funFactText.style.opacity = 0;
                        setTimeout(() => {
                            funFactText.textContent = data.fun_fact || 'No fun fact available';
                            funFactText.style.opacity = 1;
                        }, 600);
                    } else {
                        console.error('Invalid or empty response:', data);
                    }
                } catch (error) {
                    console.error('Error fetching fun fact:', error);
                }
            };

            // Attach the function to the button click event
            if (getFunFactButton) {
                getFunFactButton.addEventListener('click', getFunFact);
            } else {
                console.error('Missing element with ID: get-fun-fact-btn');
            }

            // Initial fetch when the page loads
            getFunFact();

            // Set interval for automatic update (e.g., every 10 seconds)
            setInterval(getFunFact, 10000); // 10000 milliseconds = 10 seconds
        });
    </script>
{% endblock %}
